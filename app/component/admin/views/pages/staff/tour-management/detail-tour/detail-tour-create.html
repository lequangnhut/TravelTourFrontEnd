<div ng-include="'app/component/utils/loading-html.html'"></div>

<div class="container mt-3 mb-5">
    <div class="header-control mb-4">
        <div class="">
            <div class="d-flex align-items-center row">
                <div class="col-lg-6">
                    <h3 class="color-green fw-bold text-uppercase">Thêm tour chi tiết</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="card card-custom">
        <form class="row g-3 form-input-custom" name="tourDetailForm" ng-submit="createTourDetailSubmit()"
              novalidate>
            <div class="col-md-6">
                <label for="tourNameSelect" class="form-label">Tên tour</label>
                <select id="tourNameSelect" class="form-select"
                        name="tourNameSelect"
                        ng-model="tourDetail.tourId"
                        ng-options="tour.id as tour.tourName for tour in tourBasicList"
                        ng-class="{ 'is-invalid': tourDetailForm.tourNameSelect.$touched && tourDetailForm.tourNameSelect.$error.required,
                                            'is-valid': tourDetailForm.tourNameSelect.$touched && tourDetailForm.tourNameSelect.$valid}"
                        required>
                    <option value="" disabled selected>Chọn tour</option>
                </select>
                <small class="text-danger"
                       ng-show="tourDetailForm.tourNameSelect.$touched && tourDetailForm.tourNameSelect.$error.required">
                    Vui lòng chọn tên tour!
                </small>
            </div>

            <div class="col-md-6">
                <label for="tourGuideSelect" class="form-label">Hướng dẫn viên</label>
                <select id="tourGuideSelect" class="form-select"
                        name="tourGuideSelect"
                        ng-model="tourDetail.guideId"
                        ng-options="usersByRolesIsGuild.id as usersByRolesIsGuild.fullName for usersByRolesIsGuild in UsersByRolesIsGuildSelect"
                        ng-class="{ 'is-invalid': tourDetailForm.tourGuideSelect.$touched && tourDetailForm.tourGuideSelect.$error.required,
                                            'is-valid': tourDetailForm.tourGuideSelect.$touched && tourDetailForm.tourGuideSelect.$valid}"
                        required>
                    <option value="" disabled selected>Chọn hướng dẫn viên</option>
                </select>
                <small class="text-danger"
                       ng-show="tourDetailForm.tourGuideSelect.$touched && tourDetailForm.tourGuideSelect.$error.required">
                    Vui lòng chọn hướng dẫn viên!
                </small>
            </div>

            <div class="col-md-6">
                <label for="numberOfGuests" class="form-label">Số khách</label>
                <input type="number" class="form-control" id="numberOfGuests" placeholder="Nhập số khách"
                       name="numberOfGuests"
                       ng-model="tourDetail.numberOfGuests"
                       ng-class="{ 'is-invalid': tourDetailForm.numberOfGuests.$touched && (!tourDetailForm.numberOfGuests.$valid || !isNumberOfGuestsValid()),
                                            'is-valid': tourDetailForm.numberOfGuests.$touched && (tourDetailForm.numberOfGuests.$valid || isNumberOfGuestsValid())}"
                       required>
                <small class="text-danger"
                       ng-show="tourDetailForm.numberOfGuests.$touched && tourDetailForm.numberOfGuests.$error.required">
                    Số khách không được bỏ trống!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.numberOfGuests.$touched && !isNumberOfGuestsValid()">
                    Số lượng khách phải từ 16 đến 50!
                </small>
            </div>

            <div class="col-md-6">
                <label for="minimumNumberOfGuests" class="form-label">Số khách tối thiểu</label>
                <input type="number" class="form-control" id="minimumNumberOfGuests"
                       placeholder="Nhập số khách tối thiểu"
                       name="minimumNumberOfGuests"
                       ng-model="tourDetail.minimumNumberOfGuests"
                       ng-class="{ 'is-invalid': tourDetailForm.minimumNumberOfGuests.$touched && (!tourDetailForm.minimumNumberOfGuests.$valid || !MinimumNumberOfGuestsValid()),
                                            'is-valid': tourDetailForm.minimumNumberOfGuests.$touched && (tourDetailForm.minimumNumberOfGuests.$valid || MinimumNumberOfGuestsValid())}"
                       required>
                <small class="text-danger"
                       ng-show="tourDetailForm.minimumNumberOfGuests.$touched && tourDetailForm.minimumNumberOfGuests.$error.required">
                    Số khách không được bỏ trống!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.minimumNumberOfGuests.$touched && !MinimumNumberOfGuestsValid()">
                    Số lượng khách phải từ 1 đến 16!
                </small>
            </div>

            <div class="col-md-6">
                <label class="form-label">Điểm đi</label>
                <select class="form-select"
                        name="fromLocation"
                        ng-class="{ 'is-invalid': tourDetailForm.fromLocation.$invalid && tourDetailForm.fromLocation.$touched,
                                            'is-valid': tourDetailForm.fromLocation.$valid && tourDetailForm.fromLocation.$touched }"
                        ng-options="city.Name as city.Name for city in provinces"
                        ng-change="onProvinceChange('fromLocation') || updateToLocation()"
                        ng-model="tourDetail.fromLocation"
                        required
                >
                    <option value="" disabled selected>Chọn Điểm đi</option>
                </select>
                <small class="text-danger"
                       ng-show="tourDetailForm.fromLocation.$touched && tourDetailForm.fromLocation.$error.required">
                    Vui lòng chọn Điểm đi
                </small>
            </div>

            <div class="col-md-6">
                <label class="form-label">Điểm đến</label>
                <select class="form-select"
                        name="toLocation"
                        ng-class="{ 'is-invalid': tourDetailForm.toLocation.$invalid && tourDetailForm.toLocation.$touched,
                                            'is-valid': tourDetailForm.toLocation.$valid && tourDetailForm.toLocation.$touched }"
                        ng-options="city.Name as city.Name for city in provinces"
                        ng-change="onProvinceChange('toLocation') || updateToLocation()"
                        ng-model="tourDetail.toLocation"
                        required
                >
                    <option value="" disabled selected>Chọn Điểm đến</option>
                </select>
                <small class="text-danger"
                       ng-show="tourDetailForm.toLocation.$touched && tourDetailForm.toLocation.$error.required">
                    Vui lòng chọn Điểm đến
                </small>
                <small class="text-danger" ng-show="toLocationError">
                    Điểm đi và điểm đến không thể trùng nhau!
                </small>
            </div>

            <div class="col-md-6">
                <label for="departureDate" class="form-label">Ngày đi</label>
                <input type="date" class="form-control" id="departureDate"
                       name="departureDate"
                       ng-model="tourDetail.departureDate"
                       ng-class="{ 'is-invalid': tourDetailForm.departureDate.$touched && (!tourDetailForm.departureDate.$valid || !isStartDateValid()),
                                            'is-valid': tourDetailForm.departureDate.$touched && (tourDetailForm.departureDate.$valid || isStartDateValid())}"
                       required>
                <small class="text-danger"
                       ng-show="tourDetailForm.departureDate.$touched && !tourDetailForm.departureDate.$valid">
                    Vui lòng nhập ngày đi hợp lệ!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.departureDate.$touched && !isStartDateValid()">
                    Ngày đi không thể sau ngày về!
                </small>
            </div>

            <div class="col-md-6">
                <label for="arrivalDate" class="form-label">Ngày về</label>
                <input type="date" class="form-control" id="arrivalDate"
                       name="arrivalDate"
                       ng-model="tourDetail.arrivalDate"
                       ng-class="{ 'is-invalid': tourDetailForm.arrivalDate.$touched && (!tourDetailForm.arrivalDate.$valid || !isEndDateValid()),
                                            'is-valid': tourDetailForm.arrivalDate.$touched && (tourDetailForm.arrivalDate.$valid || isEndDateValid()) }"
                       required>
                <small class="text-danger"
                       ng-show="tourDetailForm.arrivalDate.$touched && !tourDetailForm.arrivalDate.$valid">
                    Vui lòng chọn ngày về!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.arrivalDate.$touched && !isEndDateValid()">
                    Ngày về phải lớn hơn hoặc bằng ngày đi!
                </small>
            </div>

            <div class="col-md-4">
                <label class="form-label">Hình ảnh tour</label>
                <input class="form-control"
                       type="file"
                       name="tourDetailImage"
                       ng-model="tourDetail.tourDetailImage"
                       accept="image/*"
                       ng-class="{ 'is-invalid': tourDetailForm.tourDetailImage.$invalid && tourDetailForm.tourDetailImage.$touched, 'is-valid': tourDetailForm.tourDetailImage.$valid && tourDetailForm.tourDetailImage.$touched }"
                       ngf-select="uploadTourDetailImg($files)"
                       ngf-multiple="true"
                       ngf-max-size="10MB"
                       ngf-max-files="5"
                       required
                >
                <small class="text-danger"
                       ng-show="tourDetailForm.tourDetailImage.$touched && tourDetailForm.tourDetailImage.$error.required">
                    Vui lòng chọn ít nhất một ảnh!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.tourDetailImage.$error.ngfMaxFiles">
                    Bạn chỉ được chọn tối đa 5 ảnh!
                </small>
            </div>

            <div class="col-md-4">
                <label for="unitPrice" class="form-label">Giá</label>
                <input type="text"
                       class="form-control"
                       id="unitPrice"
                       placeholder="1.000.000"
                       name="unitPrice"
                       ng-model="tourDetail.unitPrice"
                       ng-class="{ 'is-invalid': (tourDetailForm.unitPrice.$touched && (!tourDetailForm.unitPrice.$valid || !isPriceValid() || invalidPriceFormat)),
                                            'is-valid': tourDetailForm.unitPrice.$touched && (tourDetailForm.unitPrice.$valid || isPriceValid())}"
                       format-price-input
                       ng-keypress="onPriceKeyPress($event); checkPriceFormat()"
                       required>
                <small class="text-danger"
                       ng-show="tourDetailForm.unitPrice.$touched && tourDetailForm.unitPrice.$error.required">
                    Giá không được bỏ trống!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.unitPrice.$touched && invalidPriceFormat">
                    Giá không đúng định dạng số!
                </small>
                <small class="text-danger"
                       ng-show="tourDetailForm.unitPrice.$touched && !isPriceValid()">
                    Giá phải lớn hơn 0!
                </small>
            </div>

            <div class="col-md-4">
                <label for="note" class="form-label">Ghi chú</label>
                <input class="form-control" type="text" id="note" placeholder="....."
                       ng-model="tourDetail.tourDetailNotes">
            </div>

            <div class="col-12">
                <label for="note" class="form-label">Nội dung ghi chú</label>
                <textarea class="form-control"
                          id="editor"
                          name="tourDetailDescription"
                          ng-model="tourDetail.tourDetailDescription"
                          ck-editor
                >
                </textarea>
            </div>

            <div class="col-12 d-flex justify-content-end mt-5">
                <button class="btn" type="button" style="margin-right: 20px">
                    <a class="btn" href="/admin/detail-tour-list">Trở về</a>
                </button>
                <button type="submit" class="btn btn-submit fw-bold"
                        ng-disabled="tourDetailForm.$invalid || !isStartDateValid() || !isNumberOfGuestsValid()">
                    Thêm tour
                </button>
            </div>
        </form>
    </div>
</div>